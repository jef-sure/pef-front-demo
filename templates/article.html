[% WRAPPER main_layout.tt 
    title = "Article"
%]
[% IF form.cookie eq '' or form.cookie == 0 %]
	<script type="text/javascript">
	<!--
		window.location = '/';
	//-->
	</script>
[% ELSE %]
  [% rart = "get article with comments".model(id_article => 0 + form.cookie) %]
  [% IF rart.result eq 'OK' %]

		<!-- articles -->
		<div class="articles">

			<!-- article -->
			<article class="article one-article" id="[% rart.article.id_article %]">
				<!-- text -->
				<div class="text">

					<h3><a href="#">[% rart.article.title %]</a></h3>

					<div class="btn-with-loader disp-ib btn-delete-article">
						<input type="submit" class="btn" id="delete_article_send_btn" value="Delete article">
						<div class="loader hidden" id="loader_delete_article"></div>
					</div>

					<p class="author">[% rart.article.author %]<time class="date">([% rart.article.pub_date %])</time></p>
					[% rart.article.content %]
					<input type="hidden" id="main_id_article" value="[% rart.article.id_article %]">
					<p><a href="#" id="leave_comment_for_article">Leave a comment</a></p>
				</div><!-- text -->
				<!-- comments -->
				<div class="comments">

					<!-- show comments link -->
					<div class="show-comments-box">
						<a href="#" class="show-comments-link">[% mn('$1 comment', rart.comments.size, rart.comments.size) %]</a>
					</div>

					<!-- comments list -->
					<div class="comments">
    [% FOR comment in rart.comments -%]
						<!-- comment -->
						<div class="comment" id="comment_[% comment.id_comment %]">
							<p><time class="date">([% comment.pub_date %])</time>[% comment.author %]</p>
							<p>[% comment.comment %]</p>
							<p class="comment-answer-link"><a href="#" class="leave-comment" id="leave_comment_[% comment.id_comment %]">leave a comment</a> | <a href="#" class="delete-comment" id="delete_comment_[% comment.id_comment %]">delete comment</a></p>
						</div>
						<!-- comment -->
    [% END -%]
					</div><!-- comments list -->

				</div><!-- comments -->
				<!-- comment form -->
				<div class="comment-form hidden" id="comment_form_box">
					<form method="post" action="/ajaxAddComment" id="comment_form">
						<input type="hidden" name="author" id="author" value="author">
						<input type="hidden" name="id_article" id="id_article">
						<input type="hidden" name="id_comment_parent" id="id_comment_parent">

						<textarea name="comment" id="comment"></textarea>
      [% author = "get author info".model -%]
      [% IF author.result ne 'OK' -%]
        [% captcha="captcha".model() -%]
						<input type="hidden" name="captcha_hash" id="captcha_hash" value="[% captcha.code %]" >
						<img src="[% config('www_static_captchas_path') %][% captcha.code %].jpg">
						<input type="text" class="fld w-100" name="captcha" id="captcha" autocomplete="off">
      [% END IF -%]
						<div class="btn-with-loader disp-ib">
							<input type="submit" class="btn ml-10" id="add_comment_btn" value="Leave a comment">
							<div class="loader hidden" id="loader_add_comment"></div>
						</div>
					</form>
				</div><!-- comment form -->

			</article><!-- article -->

		
		</div><!-- articles -->
  [% ELSE %]
<h1>[% rart.answer %]</h1>
  [% END %]
[% END %]
[% END %]

